"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function generateContent(e,n){return"<div class='iw-container'><h3 class='iw-title'>"+e.name+"</h3><div class='iw-section'><i class='material-icons'>place</i><span class='iw-info'>"+formatAddress(e.formatted_address)+"</span></div><div class='iw-section'><i class='material-icons'>local_phone</i><span class='iw-info'>"+e.formatted_phone_number+"</span></div><div class='iw-section'><i class='material-icons'>favorite</i><span class='iw-info'>"+e.rating+"</span></div><div class='iw-section'><i class='material-icons'>public</i><span class='iw-info'><a class='iw-link' href='"+e.website+"' target='blank'>"+formatUrl(e.website)+"</a></span></div><div class='uber-info'><img src='img/uber_rides_api_icon.svg'><div class='uber-estimate'>"+n+"</div></div></div>"}function formatUrl(e){return e=e.replace(/((https)|(http)):\/\//g,""),e=e.substr(0,e.indexOf("/"))}function formatAddress(e){return e.replace(",","<br>")}function getUberInfo(e,n){return $.ajax({url:"https://api.uber.com/v1/estimates/price",method:"GET",data:{server_token:"5GZQyy22lia0d4g1CqXr8OWLqhDE3M6MguQ14KQw",start_latitude:userPosition.lat,start_longitude:userPosition.lng,end_latitude:e.lat,end_longitude:e.lng},success:n.onsuccess,error:n.onerror})}function initMap(){google||alert("asdaosd"),map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.6419628,lng:-122.5127333},zoom:10}),infowindow=new google.maps.InfoWindow,places=new google.maps.places.PlacesService(map);var e=new google.maps.OverlayView;e.draw=function(){this.getPanes().markerLayer.className="markerLayer"},e.setMap(map);for(var n,t=new google.maps.LatLngBounds,i=0,o=locations.length;i<o;i++)n=new google.maps.Marker({position:locations[i].position,map:map,name:locations[i].name,id:locations[i].placeId,animation:google.maps.Animation.DROP}),markers.push(n),infowindows.push(new google.maps.InfoWindow),t.extend(n.position);map.fitBounds(t);for(var s=[],i=0,o=locations.length;i<o;i++)s.push(new Gym(locations[i],markers[i],infowindows[i]));viewModel=new ViewModel(s),ko.applyBindings(viewModel)}function googleError(){alert("Google Maps could not be loaded")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}(),map,infowindow,places,markers=[],infowindows=[],viewModel,locations=[{name:"Planet Granite San Francisco",placeId:"ChIJYR3cR92GhYAReMwzpHwVcI8",position:{lat:37.8041267,lng:-122.4685219}},{name:"Dogpatch Boulders",placeId:"ChIJ2xYuRrp_j4ARU9Lx0LBnqrY",position:{lat:37.7566538,lng:-122.389994}},{name:"Mission Cliffs",placeId:"ChIJQ2qEqDB-j4ARfAbDE0-IWvo",position:{lat:37.7610241,lng:-122.4147971}},{name:"Great Western Power Company",placeId:"ChIJiZODxK2Aj4ARTMot5wllmGU",position:{lat:37.8255233,lng:-122.2887678}},{name:"Berkeley Ironworks",placeId:"ChIJzXxD1PV-hYAR4VEMx86aHVw",position:{lat:37.8508457,lng:-122.2947798}}],Gym=function(){function e(n,t,i){_classCallCheck(this,e);var o=this;this.uberEstimate=null,this.generalInfo=n,this.marker=t,this.details=null,this.content="",this.infowindow=i,this.marker.addListener("click",function(){infowindows.forEach(function(e){e.close()}),o.updateSelected()})}return _createClass(e,[{key:"updateSelected",value:function(){var e=this;e.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setAnimation(null)},750),e.uberEstimate||getUberInfo(e.generalInfo.position,{onsuccess:function(n){e.uberEstimate=n.prices[0].estimate,e.content=generateContent(e.details,e.uberEstimate),e.infowindow.setContent(e.content)},onerror:function(n){e.content=generateContent(e.details,"No data"),e.infowindow.setContent(e.content)}}),e.details?(e.infowindow.setContent(e.content),e.infowindow.open(map,e.marker)):places.getDetails({placeId:e.generalInfo.placeId},function(n,t){t==google.maps.places.PlacesServiceStatus.OK&&(e.details=n,e.content=generateContent(e.details,e.uberEstimate?e.uberEstimate:"Loading..."),e.infowindow.setContent(e.content),e.infowindow.open(map,e.marker))})}}]),e}(),ViewModel=function(e){var n=this;this.searchFocused=ko.observable(!0),this.listVisible=ko.observable(!0),this.currentLocation=ko.observable(null),this.query=ko.observable(""),this.gymList=ko.observableArray(e),this.buttonClass=ko.observable("search"),this.filterLocations=ko.computed(function(){var e=n.query().toLowerCase();return e?(n.currentLocation().infowindow.close(),ko.utils.arrayFilter(n.gymList(),function(n){var t=n.generalInfo.name.toLowerCase().indexOf(e)!==-1;return n.marker.setVisible(t),t})):(n.gymList().forEach(function(e){e.marker.setVisible(!0)}),n.listVisible(!0),n.gymList())}),this.submitForm=function(){n.selectFirstLocation()},this.listItemClicked=function(){n.selectLocation(this)},this.inputClicked=function(){n.searchFocused(!0)},this.mapClicked=function(){n.searchFocused(!1)},this.selectLocation=function(e){infowindows.forEach(function(e){e.close()}),n.currentLocation(e),n.query(e.generalInfo.name),e.updateSelected()},this.selectFirstLocation=function(){var e=n.filterLocations();e.length>0&&n.query().length>0&&n.selectLocation(e[0])},this.clearSearch=function(){n.currentLocation(null),n.query(""),n.searchFocused(!0)},this.query.subscribe(function(e){""===e?n.buttonClass("search"):n.buttonClass("close")}),this.searchFocused.subscribe(function(e){e?n.listVisible(!0):setTimeout(function(){n.listVisible(!1)},100)})},userPosition={lat:"",lng:""};navigator.geolocation.watchPosition(function(e){userPosition.lat=e.coords.latitude,userPosition.lng=e.coords.longitude});