"use strict";function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function generateContent(e,i){return $.parseHTML("<div class='iw-container'><h3 class='iw-title'>"+e.name+"</h3><div class='iw-section'><i class='material-icons'>place</i><span class='iw-info'>"+formatAddress(e.formatted_address)+"</span></div><div class='iw-section'><i class='material-icons'>local_phone</i><span class='iw-info'>"+e.formatted_phone_number+"</span></div><div class='iw-section'><i class='material-icons'>favorite</i><span class='iw-info'>"+e.rating+"</span></div><div class='iw-section'><i class='material-icons'>public</i><span class='iw-info'><a class='iw-link' href='"+e.website+"' target='blank'>"+formatUrl(e.website)+"</a></span></div><div class='uber-info'><img src='img/uber_rides_api_icon.svg'><div class='uber-estimate'>"+i+"</div></div></div>")[0]}function formatUrl(e){return e=e.replace(/((https)|(http)):\/\//g,""),e=e.substr(0,e.indexOf("/"))}function formatAddress(e){return e.replace(",","<br>")}function getUberInfo(e,i){return $.ajax({url:"https://api.uber.com/v1/estimates/price",method:"GET",data:{server_token:"5GZQyy22lia0d4g1CqXr8OWLqhDE3M6MguQ14KQw",start_latitude:userPosition.lat,start_longitude:userPosition.lng,end_latitude:e.lat,end_longitude:e.lng},success:i.onsuccess,error:i.onerror})}function initMap(){google||alert("asdaosd"),map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.6419628,lng:-122.5127333},zoom:10}),infowindow=new google.maps.InfoWindow,places=new google.maps.places.PlacesService(map);var e=new google.maps.OverlayView;e.draw=function(){this.getPanes().markerLayer.className="markerLayer"},e.setMap(map);for(var i,t=new google.maps.LatLngBounds,n=0,a=locations.length;n<a;n++)i=new google.maps.Marker({position:locations[n].position,map:map,name:locations[n].name,id:locations[n].placeId,animation:google.maps.Animation.DROP}),markers.push(i),t.extend(i.position);map.fitBounds(t);for(var s=[],n=0,a=locations.length;n<a;n++)s.push(new Gym(locations[n],markers[n]));viewModel=new ViewModel(s),ko.applyBindings(viewModel)}function googleError(){alert("Google Maps could not be loaded")}var _createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(i,t,n){return t&&e(i.prototype,t),n&&e(i,n),i}}(),map,infowindow,places,markers=[],viewModel,infowindowTmpl=$.parseHTML("<div class='iw-container'><h3 class='iw-title' data-bind='text: iwName'></h3><div class='iw-section'><i class='material-icons'>place</i><span class='iw-info' data-bind='text: iwAddress'></span></div><div class='iw-section'><i class='material-icons'>local_phone</i><span class='iw-info' data-bind='text: iwPhone'></span></div><div class='iw-section'><i class='material-icons'>favorite</i><span class='iw-info' data-bind='text: iwRating'></span></div><div class='iw-section'><i class='material-icons'>public</i><span class='iw-info'><a class='iw-link'target='blank' data-bind='text: iwWebsite, attr { href: iwUrl }'></a></span></div><div class='uber-info'><img src='img/uber_rides_api_icon.svg'><div class='uber-estimate' data-bind='text: uberMsg'></div></div></div>")[0],locations=[{name:"Planet Granite San Francisco",placeId:"ChIJYR3cR92GhYAReMwzpHwVcI8",position:{lat:37.8041267,lng:-122.4685219}},{name:"Dogpatch Boulders",placeId:"ChIJ2xYuRrp_j4ARU9Lx0LBnqrY",position:{lat:37.7566538,lng:-122.389994}},{name:"Mission Cliffs",placeId:"ChIJQ2qEqDB-j4ARfAbDE0-IWvo",position:{lat:37.7610241,lng:-122.4147971}},{name:"Great Western Power Company",placeId:"ChIJiZODxK2Aj4ARTMot5wllmGU",position:{lat:37.8255233,lng:-122.2887678}},{name:"Berkeley Ironworks",placeId:"ChIJzXxD1PV-hYAR4VEMx86aHVw",position:{lat:37.8508457,lng:-122.2947798}}],Gym=function(){function e(i,t){_classCallCheck(this,e);var n=this;this.uberEstimate=null,this.generalInfo=i,this.marker=t,this.details=null,this.content="",this.marker.addListener("click",function(){n.updateSelected()})}return _createClass(e,[{key:"updateSelected",value:function(){var e=this;e.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setAnimation(null)},750),e.uberEstimate||getUberInfo(e.generalInfo.position,{onsuccess:function(i){e.uberEstimate=i.prices[0].estimate,e.content=generateContent(e.details,e.uberEstimate),infowindow.setContent(e.content)},onerror:function(i){e.content=generateContent(e.details,"No data"),infowindow.setContent(e.content)}}),e.details?(infowindow.setContent(e.content),infowindow.open(map,e.marker)):places.getDetails({placeId:e.generalInfo.placeId},function(i,t){t==google.maps.places.PlacesServiceStatus.OK&&(e.details=i,e.content=generateContent(e.details,e.uberEstimate?e.uberEstimate:"Loading..."),infowindow.setContent(e.content),infowindow.open(map,e.marker))})}}]),e}(),ViewModel=function(e){var i=this;this.searchFocused=ko.observable(!0),this.listVisible=ko.observable(!0),this.currentLocation=ko.observable(null),this.query=ko.observable(""),this.gymList=ko.observableArray(e),this.buttonClass=ko.observable("search"),this.filterLocations=ko.computed(function(){infowindow.close();var e=i.query().toLowerCase();return e?ko.utils.arrayFilter(i.gymList(),function(i){var t=i.generalInfo.name.toLowerCase().indexOf(e)!==-1;return i.marker.setVisible(t),t}):(i.gymList().forEach(function(e){e.marker.setVisible(!0)}),i.listVisible(!0),i.gymList())}),this.submitForm=function(){i.selectFirstLocation()},this.listItemClicked=function(){i.selectLocation(this)},this.inputClicked=function(){i.searchFocused(!0)},this.mapClicked=function(){i.searchFocused(!1)},this.selectLocation=function(e){i.currentLocation(e),i.query(e.generalInfo.name),e.updateSelected()},this.selectFirstLocation=function(){var e=i.filterLocations();e.length>0&&i.query().length>0&&i.selectLocation(e[0])},this.clearSearch=function(){i.currentLocation(null),i.query(""),i.searchFocused(!0)},this.query.subscribe(function(e){""===e?i.buttonClass("search"):i.buttonClass("close")}),this.searchFocused.subscribe(function(e){e?i.listVisible(!0):setTimeout(function(){i.listVisible(!1)},100)})},userPosition={lat:"",lng:""};navigator.geolocation.watchPosition(function(e){userPosition.lat=e.coords.latitude,userPosition.lng=e.coords.longitude});