"use strict";function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function generateContent(e){return $.parseHTML("<div class='iw-container'><h3 class='iw-title'>"+e.name+"</h3><div class='iw-section'><i class='material-icons'>place</i><span class='iw-info'>"+formatAddress(e.formatted_address)+"</span></div><div class='iw-section'><i class='material-icons'>local_phone</i><span class='iw-info'>"+e.formatted_phone_number+"</span></div><div class='iw-section'><i class='material-icons'>favorite</i><span class='iw-info'>"+e.rating+"</span></div><div class='iw-section'><i class='material-icons'>public</i><span class='iw-info'><a class='iw-link' href='"+e.website+"' target='blank'>"+formatUrl(e.website)+"</a></span></div><div class='uber-info'><img src='img/uber_rides_api_icon.svg'><div class='uber-estimate' data-bind='text: uberMsg'></div></div></div>")[0]}function formatUrl(e){return e=e.replace(/((https)|(http)):\/\//g,""),e=e.substr(0,e.indexOf("/"))}function formatAddress(e){return e.replace(",","<br>")}function getUberInfo(e,i){return $.ajax({url:"https://api.uber.com/v1/estimates/price",method:"GET",data:{server_token:"5GZQyy22lia0d4g1CqXr8OWLqhDE3M6MguQ14KQw",start_latitude:userPosition.lat,start_longitude:userPosition.lng,end_latitude:e.lat,end_longitude:e.lng},success:i.onsuccess,error:i.onerror})}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.6419628,lng:-122.5127333},zoom:10}),infowindow=new google.maps.InfoWindow,places=new google.maps.places.PlacesService(map);var e=new google.maps.OverlayView;e.draw=function(){this.getPanes().markerLayer.className="markerLayer"},e.setMap(map);for(var i,s=new google.maps.LatLngBounds,t=0,a=locations.length;t<a;t++)i=new google.maps.Marker({position:locations[t].position,map:map,name:locations[t].name,id:locations[t].placeId,animation:google.maps.Animation.DROP}),markers.push(i),s.extend(i.position);map.fitBounds(s);for(var n=[],t=0,a=locations.length;t<a;t++)n.push(new Gym(locations[t],markers[t]));viewModel=new ViewModel(n),ko.applyBindings(viewModel)}var map,infowindow,places,markers=[],viewModel,infowindowTmpl=$.parseHTML("<div class='iw-container'><h3 class='iw-title' data-bind='text: iwName'></h3><div class='iw-section'><i class='material-icons'>place</i><span class='iw-info' data-bind='text: iwAddress'></span></div><div class='iw-section'><i class='material-icons'>local_phone</i><span class='iw-info' data-bind='text: iwPhone'></span></div><div class='iw-section'><i class='material-icons'>favorite</i><span class='iw-info' data-bind='text: iwRating'></span></div><div class='iw-section'><i class='material-icons'>public</i><span class='iw-info'><a class='iw-link'target='blank' data-bind='text: iwWebsite, attr { href: iwUrl }'></a></span></div><div class='uber-info'><img src='img/uber_rides_api_icon.svg'><div class='uber-estimate' data-bind='text: uberMsg'></div></div></div>")[0],locations=[{name:"Planet Granite San Francisco",placeId:"ChIJYR3cR92GhYAReMwzpHwVcI8",position:{lat:37.8041267,lng:-122.4685219}},{name:"Dogpatch Boulders",placeId:"ChIJ2xYuRrp_j4ARU9Lx0LBnqrY",position:{lat:37.7566538,lng:-122.389994}},{name:"Mission Cliffs",placeId:"ChIJQ2qEqDB-j4ARfAbDE0-IWvo",position:{lat:37.7610241,lng:-122.4147971}},{name:"Great Western Power Company",placeId:"ChIJiZODxK2Aj4ARTMot5wllmGU",position:{lat:37.8255233,lng:-122.2887678}},{name:"Berkeley Ironworks",placeId:"ChIJzXxD1PV-hYAR4VEMx86aHVw",position:{lat:37.8508457,lng:-122.2947798}}],Gym=function e(i,s){_classCallCheck(this,e);var t=this;this.uberEstimate=null,this.generalInfo=i,this.marker=s,this.details=null,this.content="",this.marker.addListener("click",function(){t.updateSelected()}),this.updateSelected=function(){t.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){t.marker.setAnimation(null)},750),t.uberEstimate?viewModel.uberMsg(t.uberEstimate):(viewModel.uberMsg("Loading..."),getUberInfo(t.generalInfo.position,{onsuccess:function(e){t.uberEstimate=e.prices[0].estimate,viewModel.uberMsg(t.uberEstimate)},onerror:function(e){viewModel.uberMsg("No data")}})),t.details?(infowindow.setContent(t.content),infowindow.open(map,s)):places.getDetails({placeId:t.generalInfo.placeId},function(e,i){i==google.maps.places.PlacesServiceStatus.OK&&(t.details=e,t.content=generateContent(t.details),infowindow.setContent(t.content),infowindow.open(map,s),ko.applyBindings(viewModel,t.content))})}},ViewModel=function(e){var i=this;this.searchFocused=ko.observable(!0),this.listVisible=ko.observable(!0),this.currentLocation=ko.observable(null),this.query=ko.observable(""),this.gymList=ko.observableArray(e),this.buttonClass=ko.observable("search"),this.uberMsg=ko.observable("Loading..."),this.filterLocations=ko.computed(function(){infowindow.close();var e=i.query().toLowerCase();return e?ko.utils.arrayFilter(i.gymList(),function(i){var s=i.generalInfo.name.toLowerCase().indexOf(e)!==-1;return i.marker.setVisible(s),s}):(i.gymList().forEach(function(e){e.marker.setVisible(!0)}),i.listVisible(!0),i.gymList())}),this.submitForm=function(){i.selectFirstLocation()},this.listItemClicked=function(){i.selectLocation(this)},this.inputClicked=function(){i.searchFocused(!0)},this.mapClicked=function(){i.searchFocused(!1)},this.selectLocation=function(e){i.currentLocation(e),i.query(e.generalInfo.name),e.updateSelected()},this.selectFirstLocation=function(){var e=i.filterLocations();e.length>0&&i.query().length>0&&i.selectLocation(e[0])},this.clearSearch=function(){i.currentLocation(null),i.query(""),i.searchFocused(!0)},this.query.subscribe(function(e){""===e?i.buttonClass("search"):i.buttonClass("close")}),this.searchFocused.subscribe(function(e){e?i.listVisible(!0):setTimeout(function(){i.listVisible(!1)},100)})},userPosition={lat:"",lng:""};navigator.geolocation.watchPosition(function(e){userPosition.lat=e.coords.latitude,userPosition.lng=e.coords.longitude});