"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function generateContent(e){return"<h3 class='iw-title'>"+e.name+"</h3><div class='iw-section'><i class='material-icons'>place</i><span class='iw-info'>"+formatAddress(e.formatted_address)+"</span></div><div class='iw-section'><i class='material-icons'>local_phone</i><span class='iw-info'>"+e.formatted_phone_number+"</span></div><div class='iw-section'><i class='material-icons'>favorite</i><span class='iw-info'>"+e.rating+"</span></div><div class='iw-section'><i class='material-icons'>public</i><span class='iw-info'><a class='iw-link' href='"+e.website+"' target='blank'>"+formatUrl(e.website)+"</a></span></div>"}function formatUrl(e){return e=e.replace(/((https)|(http)):\/\//g,""),e=e.substr(0,e.indexOf("/"))}function formatAddress(e){return e.replace(",","<br>")}function getUberInfo(e){return $.ajax({url:"https://api.uber.com/v1/estimates/price",method:"GET",data:{server_token:"5GZQyy22lia0d4g1CqXr8OWLqhDE3M6MguQ14KQw",start_latitude:userPosition.lat,start_longitude:userPosition.lng,end_latitude:e.lat,end_longitude:e.lng},success:function(e){$(".uber-estimate").html(e.prices[0].estimate)},error:function(e){$(".uber-estimate").html("No data")}})}function initMap(){map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.6419628,lng:-122.5127333},zoom:10}),infowindow=new google.maps.InfoWindow,places=new google.maps.places.PlacesService(map);var e=new google.maps.OverlayView;e.draw=function(){this.getPanes().markerLayer.id="markerLayer"},e.setMap(map);for(var t,i=[{name:"Planet Granite San Francisco",placeId:"ChIJYR3cR92GhYAReMwzpHwVcI8",position:{lat:37.8041267,lng:-122.4685219}},{name:"Dogpatch Boulders",placeId:"ChIJ2xYuRrp_j4ARU9Lx0LBnqrY",position:{lat:37.7566538,lng:-122.389994}},{name:"Mission Cliffs",placeId:"ChIJQ2qEqDB-j4ARfAbDE0-IWvo",position:{lat:37.7610241,lng:-122.4147971}},{name:"Great Western Power Company",placeId:"ChIJiZODxK2Aj4ARTMot5wllmGU",position:{lat:37.8255233,lng:-122.2887678}},{name:"Berkeley Ironworks",placeId:"ChIJzXxD1PV-hYAR4VEMx86aHVw",position:{lat:37.8508457,lng:-122.2947798}}],n=new google.maps.LatLngBounds,s=0,a=i.length;s<a;s++)t=new google.maps.Marker({position:i[s].position,map:map,name:i[s].name,id:i[s].placeId,animation:google.maps.Animation.DROP}),markers.push(t),n.extend(t.position);map.fitBounds(n);for(var o=[],s=0,a=i.length;s<a;s++)o.push(new Gym(i[s],markers[s]));ko.applyBindings(new ViewModel(o))}var map,infowindow,places,markers=[],Gym=function e(t,i){_classCallCheck(this,e);var n=this;this.uberEstimate=null,this.generalInfo=t,this.marker=i,this.details=null,this.content="",this.uberContent="<div class='uber-info'><img src='img/uber_rides_api_icon.svg'><div class='uber-estimate'>Loading...</div></div>",this.marker.addListener("click",function(){n.updateSelected()}),this.updateSelected=function(){n.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){n.marker.setAnimation(null)},750),n.uberEstimate?n.uberContent=n.uberContent.replace("Loading...",n.uberEstimate):getUberInfo(n.generalInfo.position).done(function(){n.uberEstimate=$(".uber-estimate").html()}),n.details?(infowindow.setContent(n.content+n.uberContent),infowindow.open(map,i)):places.getDetails({placeId:n.generalInfo.placeId},function(e,t){t==google.maps.places.PlacesServiceStatus.OK&&(n.details=e,n.content=generateContent(n.details),infowindow.setContent(n.content+n.uberContent),infowindow.open(map,i))})}},ViewModel=function(e){var t=this;this.searchFocused=ko.observable(!1),this.listVisible=ko.observable(!0),this.currentLocation=ko.observable(null),this.query=ko.observable(""),this.gymList=ko.observableArray(e),this.buttonClass=ko.observable("search"),this.filterLocations=ko.computed(function(){infowindow.close();var e=t.query().toLowerCase();return e?ko.utils.arrayFilter(t.gymList(),function(t){var i=t.generalInfo.name.toLowerCase().indexOf(e)!==-1;return t.marker.setVisible(i),i}):(t.gymList().forEach(function(e){e.marker.setVisible(!0)}),t.listVisible(!0),t.gymList())}),this.submitForm=function(){t.selectFirstLocation()},this.listItemClicked=function(){t.selectLocation(this)},this.inputClicked=function(){t.searchFocused(!0)},this.mapClicked=function(){t.searchFocused(!1)},this.selectLocation=function(e){t.currentLocation(e),t.query(e.generalInfo.name),e.updateSelected()},this.selectFirstLocation=function(){var e=t.filterLocations();e.length>0&&t.query().length>0&&t.selectLocation(e[0])},this.clearSearch=function(){t.currentLocation(null),t.query(""),t.searchFocused(!0)},this.query.subscribe(function(e){""===e?t.buttonClass("search"):t.buttonClass("close")}),this.searchFocused.subscribe(function(e){e?t.listVisible(!0):setTimeout(function(){t.listVisible(!1)},100)})},userPosition={lat:"",lng:""};navigator.geolocation.watchPosition(function(e){userPosition.lat=e.coords.latitude,userPosition.lng=e.coords.longitude});