"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function generateContent(e,t){return $.parseHTML("<div class='iw-container'><h3 class='iw-title'>"+e.name+"</h3><div class='iw-section'><i class='material-icons'>place</i><span class='iw-info'>"+formatAddress(e.formatted_address)+"</span></div><div class='iw-section'><i class='material-icons'>local_phone</i><span class='iw-info'>"+e.formatted_phone_number+"</span></div><div class='iw-section'><i class='material-icons'>favorite</i><span class='iw-info'>"+e.rating+"</span></div><div class='iw-section'><i class='material-icons'>public</i><span class='iw-info'><a class='iw-link' href='"+e.website+"' target='blank'>"+formatUrl(e.website)+"</a></span></div><div class='uber-info'><img src='img/uber_rides_api_icon.svg'><div class='uber-estimate'>"+t+"</div></div></div>")[0]}function formatUrl(e){return e=e.replace(/((https)|(http)):\/\//g,""),e=e.substr(0,e.indexOf("/"))}function formatAddress(e){return e.replace(",","<br>")}function getUberInfo(e,t){return $.ajax({url:"https://api.uber.com/v1/estimates/price",method:"GET",data:{server_token:"5GZQyy22lia0d4g1CqXr8OWLqhDE3M6MguQ14KQw",start_latitude:userPosition.lat,start_longitude:userPosition.lng,end_latitude:e.lat,end_longitude:e.lng},success:t.onsuccess,error:t.onerror})}function initMap(){google||alert("asdaosd"),map=new google.maps.Map(document.getElementById("map"),{center:{lat:37.6419628,lng:-122.5127333},zoom:10}),infowindow=new google.maps.InfoWindow,places=new google.maps.places.PlacesService(map);var e=new google.maps.OverlayView;e.draw=function(){this.getPanes().markerLayer.className="markerLayer"},e.setMap(map);for(var t,n=new google.maps.LatLngBounds,i=0,o=locations.length;i<o;i++)t=new google.maps.Marker({position:locations[i].position,map:map,name:locations[i].name,id:locations[i].placeId,animation:google.maps.Animation.DROP}),markers.push(t),n.extend(t.position);map.fitBounds(n);for(var a=[],i=0,o=locations.length;i<o;i++)a.push(new Gym(locations[i],markers[i]));viewModel=new ViewModel(a),ko.applyBindings(viewModel)}function googleError(){alert("Google Maps could not be loaded")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),map,infowindow,places,markers=[],viewModel,locations=[{name:"Planet Granite San Francisco",placeId:"ChIJYR3cR92GhYAReMwzpHwVcI8",position:{lat:37.8041267,lng:-122.4685219}},{name:"Dogpatch Boulders",placeId:"ChIJ2xYuRrp_j4ARU9Lx0LBnqrY",position:{lat:37.7566538,lng:-122.389994}},{name:"Mission Cliffs",placeId:"ChIJQ2qEqDB-j4ARfAbDE0-IWvo",position:{lat:37.7610241,lng:-122.4147971}},{name:"Great Western Power Company",placeId:"ChIJiZODxK2Aj4ARTMot5wllmGU",position:{lat:37.8255233,lng:-122.2887678}},{name:"Berkeley Ironworks",placeId:"ChIJzXxD1PV-hYAR4VEMx86aHVw",position:{lat:37.8508457,lng:-122.2947798}}],Gym=function(){function e(t,n){_classCallCheck(this,e);var i=this;this.uberEstimate=null,this.generalInfo=t,this.marker=n,this.details=null,this.content="",this.marker.addListener("click",function(){i.updateSelected()})}return _createClass(e,[{key:"updateSelected",value:function(){var e=this;e.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){e.marker.setAnimation(null)},750),e.uberEstimate||getUberInfo(e.generalInfo.position,{onsuccess:function(t){e.uberEstimate=t.prices[0].estimate,e.content=generateContent(e.details,e.uberEstimate),infowindow.setContent(e.content)},onerror:function(t){e.content=generateContent(e.details,"No data"),infowindow.setContent(e.content)}}),e.details?(infowindow.setContent(e.content),infowindow.open(map,e.marker)):places.getDetails({placeId:e.generalInfo.placeId},function(t,n){n==google.maps.places.PlacesServiceStatus.OK&&(e.details=t,e.content=generateContent(e.details,e.uberEstimate?e.uberEstimate:"Loading..."),infowindow.setContent(e.content),infowindow.open(map,e.marker))})}}]),e}(),ViewModel=function(e){var t=this;this.searchFocused=ko.observable(!0),this.listVisible=ko.observable(!0),this.currentLocation=ko.observable(null),this.query=ko.observable(""),this.gymList=ko.observableArray(e),this.buttonClass=ko.observable("search"),this.filterLocations=ko.computed(function(){var e=t.query().toLowerCase();return e?(infowindow.close(),ko.utils.arrayFilter(t.gymList(),function(t){var n=t.generalInfo.name.toLowerCase().indexOf(e)!==-1;return t.marker.setVisible(n),n})):(t.gymList().forEach(function(e){e.marker.setVisible(!0)}),t.listVisible(!0),t.gymList())}),this.submitForm=function(){t.selectFirstLocation()},this.listItemClicked=function(){t.selectLocation(this)},this.inputClicked=function(){t.searchFocused(!0)},this.mapClicked=function(){t.searchFocused(!1)},this.selectLocation=function(e){t.currentLocation(e),t.query(e.generalInfo.name),e.updateSelected()},this.selectFirstLocation=function(){var e=t.filterLocations();e.length>0&&t.query().length>0&&t.selectLocation(e[0])},this.clearSearch=function(){t.currentLocation(null),t.query(""),t.searchFocused(!0)},this.query.subscribe(function(e){""===e?t.buttonClass("search"):t.buttonClass("close")}),this.searchFocused.subscribe(function(e){e?t.listVisible(!0):setTimeout(function(){t.listVisible(!1)},100)})},userPosition={lat:"",lng:""};navigator.geolocation.watchPosition(function(e){userPosition.lat=e.coords.latitude,userPosition.lng=e.coords.longitude});